<!--
  @file ImageCrop.vue
  @description ÂõæÁâáË£ÅÂàáÂ∑•ÂÖ∑ÁªÑ‰ª∂ÔºåÊîØÊåÅËá™Áî±Ë£ÅÂàáÂíåÈ¢ÑËÆæÊØî‰æãË£ÅÂàá
  @copyright UIEDÊäÄÊúØÂõ¢Èòü (https://fsuied.com)
  @author UIEDÊäÄÊúØÂõ¢Èòü
  @createDate 2024-12-22

  ÂäüËÉΩÁâπÊÄßÔºö
  1. ÊîØÊåÅÊãñÊãΩÂíåÁÇπÂáª‰∏ä‰º†ÂõæÁâá
  2. ÊîØÊåÅËá™Áî±Ë£ÅÂàáÂíåÈ¢ÑËÆæÊØî‰æãË£ÅÂàá
  3. ÊîØÊåÅÊóãËΩ¨„ÄÅÁº©ÊîæÂíåË∞ÉÊï¥‰∫ÆÂ∫¶ÂØπÊØîÂ∫¶
  4. ÊîØÊåÅÈîÆÁõòÂø´Êç∑ÈîÆÊìç‰Ωú
  5. Êú¨Âú∞Â§ÑÁêÜÔºåÊó†ÈúÄ‰∏ä‰º†ÊúçÂä°Âô®
-->

<template>
  <div class="min-h-screen">
    <div class="mx-auto">
      <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
      <div class="bg-white rounded-xl p-8 mb-4 shadow-sm">
        <div class="text-center mb-8 relative">
          <h2 class="text-4xl font-bold mb-3 relative inline-flex flex-col items-center">
            <div class="relative px-12">
              <span class="text-gray-800 hover:text-gray-600 transition-colors duration-300">{{ info.title }}</span>
            </div>
          </h2>
          <p class="text-gray-500 text-sm mt-6">{{ info.subtitle }}</p>
        </div>

        <!-- Êñá‰ª∂‰∏ä‰º†Âå∫Âüü -->
        <div v-if="!currentFile">
          <div
            class="relative border border-dashed rounded-lg min-h-[200px] flex flex-col items-center justify-center transition-colors duration-200 bg-white hover:border-blue-400"
            :class="isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-200'" @drop.prevent="handleDrop"
            @dragover.prevent="isDragging = true" @dragleave.prevent="isDragging = false">
            <input ref="fileInputRef" type="file" accept="image/*"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" @change="handleFileChange" />

            <div class="text-center px-4">
              <div class="w-8 h-8 mb-2 mx-auto">
                <svg class="w-full h-full text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </div>
              <div class="text-sm font-medium text-gray-600 mb-1">ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞ËøôÈáå</div>
              <p class="text-xs text-gray-400">ÊîØÊåÅ JPG„ÄÅPNG„ÄÅWebP Ê†ºÂºè</p>
            </div>
          </div>
        </div>

        <!-- Ë£ÅÂàáÂ∑•ÂÖ∑Âå∫Âüü -->
        <div v-else class="space-y-4">
          <div class="border rounded-lg p-6 bg-white">
            <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
            <div class="mb-6 space-y-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                  <h3 class="text-sm font-medium text-gray-700">Ë£ÅÂàáÂ∑•ÂÖ∑</h3>
                  <span class="text-xs text-gray-400">{{ currentFile?.name }}</span>
                </div>
                <div class="flex items-center space-x-3">
                  <!-- Ê†ºÂºèÈÄâÊã© -->
                  <div class="flex rounded-lg border overflow-hidden shadow-sm">
                    <button v-for="format in ['JPG', 'PNG', 'WebP']" :key="format" @click="selectedFormat = format"
                      class="px-4 py-2 text-sm font-medium transition-colors relative" :class="[
                        selectedFormat === format
                          ? 'bg-blue-500 text-white shadow-inner'
                          : 'bg-white text-gray-600 hover:bg-gray-50'
                      ]">
                      {{ format }}
                      <span v-if="selectedFormat === format"
                        class="absolute -bottom-px left-0 w-full h-0.5 bg-blue-600"></span>
                    </button>
                  </div>
                  <!-- ‰∏ãËΩΩÊåâÈíÆ -->
                  <button v-if="croppedImageUrl" @click="handleDownload"
                    class="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    <span>‰∏ãËΩΩ</span>
                  </button>
                </div>
              </div>

              <!-- Ë£ÅÂàáÊØî‰æãÊåâÈíÆÁªÑ -->
              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2">
                <button v-for="preset in cropPresets" :key="preset.value" @click="setAspectRatio(preset.value)" :class="[
                  'px-3 py-2 text-sm rounded-lg transition-all',
                  (aspectRatio === undefined && preset.value === 'free') ||
                    (aspectRatio === Number(preset.value))
                    ? 'bg-blue-500 text-white shadow-sm transform scale-[1.02]'
                    : 'border hover:bg-gray-50 text-gray-700'
                ]" :title="preset.desc">
                  {{ preset.label }}
                </button>
              </div>
            </div>

            <!-- Ë£ÅÂàáÂå∫Âüü -->
            <div class="relative bg-white rounded-lg overflow-hidden border">
              <vue-cropper ref="cropperRef" :src="imageUrl" :aspect-ratio="aspectRatio" :view-mode="2" :guides="true"
                :background="true" :rotatable="true" :scalable="true" :zoomable="true" :movable="true" :crop="onCrop"
                class="max-h-[600px]" />

              <!-- ÂõæÁâáË∞ÉÊï¥ÊéßÂà∂Èù¢Êùø -->
              <div
                class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-4 space-y-4 min-w-[200px]">
                <div>
                  <label class="text-sm text-gray-600 mb-1 block">‰∫ÆÂ∫¶</label>
                  <div class="flex items-center space-x-2">
                    <input type="range" v-model="brightness" min="0" max="200" class="flex-1 accent-blue-500"
                      @input="updateImageAdjustments" />
                    <span class="text-xs text-gray-500 w-8 text-right">{{ brightness }}%</span>
                  </div>
                </div>
                <div>
                  <label class="text-sm text-gray-600 mb-1 block">ÂØπÊØîÂ∫¶</label>
                  <div class="flex items-center space-x-2">
                    <input type="range" v-model="contrast" min="0" max="200" class="flex-1 accent-blue-500"
                      @input="updateImageAdjustments" />
                    <span class="text-xs text-gray-500 w-8 text-right">{{ contrast }}%</span>
                  </div>
                </div>
              </div>

              <!-- Áº©ÊîæÂíåÊóãËΩ¨ÊéßÂà∂ -->
              <div
                class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-3 flex items-center space-x-6">
                <!-- Áº©ÊîæÊéßÂà∂ -->
                <div class="flex items-center space-x-3">
                  <button @click="zoom(-0.1)" class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="Áº©Â∞è">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                    </svg>
                  </button>
                  <span class="text-sm font-medium w-16 text-center">{{ Math.round(scale * 100) }}%</span>
                  <button @click="zoom(0.1)" class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="ÊîæÂ§ß">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                  </button>
                </div>

                <div class="w-px h-6 bg-gray-200"></div>

                <!-- ÊóãËΩ¨ÊéßÂà∂ -->
                <div class="flex items-center space-x-3">
                  <button @click="rotate(-90)" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="ÂêëÂ∑¶ÊóãËΩ¨90¬∞">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v7h7M4 11C4 15.4183 7.58172 19 12 19c4.4183 0 8-3.5817 8-8" />
                    </svg>
                  </button>
                  <span class="text-sm font-medium w-12 text-center">{{ rotateAngle }}¬∞</span>
                  <button @click="rotate(90)" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="ÂêëÂè≥ÊóãËΩ¨90¬∞">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20 4v7h-7M20 11c0 4.4183-3.5817 8-8 8-4.4183 0-8-3.5817-8-8" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Êìç‰ΩúÊèêÁ§∫ -->
            <div class="mt-4 flex justify-between items-center px-2">
              <button @click="clearImage" class="text-sm text-gray-500 hover:text-gray-700 flex items-center space-x-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                <span>Ê∏ÖÈô§ÂõæÁâá</span>
              </button>
              <div class="text-xs text-gray-400 flex items-center space-x-4">
                <span>‚å®Ô∏è ÊñπÂêëÈîÆÂæÆË∞É‰ΩçÁΩÆ</span>
                <span>üí° ÂèåÂáªÈáçÁΩÆË£ÅÂàáÊ°Ü</span>
                <span>‚áß Shift + ÊñπÂêëÈîÆÂø´ÈÄüÁßªÂä®</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ÂäüËÉΩËØ¥ÊòéÂå∫Âüü -->
      <div class="bg-white rounded-xl p-8">
        <div class="space-y-6">
          <!-- ÂäüËÉΩÁÇπÂ±ïÁ§∫ -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="bg-white border border-gray-100 rounded-lg p-6">
              <div class="flex items-center space-x-3 mb-4">
                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center">
                  <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01" />
                  </svg>
                </div>
                <h4 class="text-base font-medium text-gray-900">‰∏ì‰∏öË£ÅÂàá</h4>
              </div>
              <p class="text-sm text-gray-600 leading-relaxed">ÊîØÊåÅ8ÁßçÈ¢ÑËÆæÊØî‰æãÂíåËá™Áî±Ë£ÅÂàáÔºåÊª°Ë∂≥Á§æ‰∫§Â™í‰Ωì„ÄÅËØÅ‰ª∂ÁÖßÁ≠âÂ§öÁßçÂú∫ÊôØÈúÄÊ±Ç</p>
            </div>

            <div class="bg-white border border-gray-100 rounded-lg p-6">
              <div class="flex items-center space-x-3 mb-4">
                <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center">
                  <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                  </svg>
                </div>
                <h4 class="text-base font-medium text-gray-900">ÂõæÂÉèË∞ÉÊï¥</h4>
              </div>
              <p class="text-sm text-gray-600 leading-relaxed">ÊîØÊåÅÊóãËΩ¨„ÄÅÁº©Êîæ„ÄÅ‰∫ÆÂ∫¶ÂíåÂØπÊØîÂ∫¶Ë∞ÉËäÇÔºåËÆ©ÂõæÁâáËææÂà∞ÊúÄ‰Ω≥ÊïàÊûú</p>
            </div>

            <div class="bg-white border border-gray-100 rounded-lg p-6">
              <div class="flex items-center space-x-3 mb-4">
                <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center">
                  <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01" />
                  </svg>
                </div>
                <h4 class="text-base font-medium text-gray-900">Â§öÊ†ºÂºèÂØºÂá∫</h4>
              </div>
              <p class="text-sm text-gray-600 leading-relaxed">ÊîØÊåÅJPG„ÄÅPNG„ÄÅWebPÊ†ºÂºèÂØºÂá∫Ôºå‰øùÊåÅÂéüÂõæË¥®ÈáèÔºåÊª°Ë∂≥‰∏çÂêåÁî®ÈÄî</p>
            </div>
          </div>

          <!-- Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î -->
          <div class="bg-white rounded-xl p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-6">Â∏∏ËßÅÈóÆÈ¢ò</h3>
            <div class="space-y-6">
              <div v-for="(item, index) in faq" :key="index"
                class="pb-6 last:pb-0 border-b border-gray-200 last:border-0">
                <h4 class="text-base font-medium text-gray-900 mb-3">{{ item.q }}</h4>
                <p class="text-sm text-gray-600 leading-relaxed">{{ item.a }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Â∑•ÂÖ∑Êé®Ëçê -->
      <ToolsRecommend :currentPath="route.path" class="mt-8" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from '@vue/runtime-core'
import { useRoute } from 'vue-router'
import VueCropper from 'vue-cropperjs'
import 'cropperjs/dist/cropper.css'
import ToolsRecommend from '@/components/Common/ToolsRecommend.vue'

// Ëé∑ÂèñÂΩìÂâçË∑ØÁî±
const route = useRoute()

// ÁªÑ‰ª∂ÈÖçÁΩÆ‰ø°ÊÅØ
const info = reactive({
  title: "ÂÖçË¥πÂú®Á∫øÂõæÁâáË£ÅÂàáÂ∑•ÂÖ∑",
  subtitle: "ÂÖçË¥π‰∏ì‰∏öÁöÑÂõæÁâáË£ÅÂàáÂ∑•ÂÖ∑ÔºåÊîØÊåÅËá™Áî±Ë£ÅÂàáÂíåÂ§öÁßçÈ¢ÑËÆæÊØî‰æã"
})

// Áä∂ÊÄÅÁÆ°ÁêÜ
const currentFile = ref<File | null>(null)
const imageUrl = ref('')
const croppedImageUrl = ref('')
const isDragging = ref(false)
const selectedFormat = ref('JPG')
const aspectRatio = ref<number | undefined>(undefined)
const brightness = ref(100)
const contrast = ref(100)
const scale = ref(1)
const rotateAngle = ref(0)
const cropperRef = ref<any>(null)

// È¢ÑË£ÅÂàáÊØî‰æã
const cropPresets = [
  { label: 'Ëá™Áî±Ë£ÅÂàá', value: 'free', desc: 'Ëá™Áî±Ë∞ÉÊï¥Ë£ÅÂàáÂå∫ÂüüÂ§ßÂ∞èÂíå‰ΩçÁΩÆ' },
  { label: '1:1 Ê≠£ÊñπÂΩ¢', value: '1', desc: 'ÈÄÇÁî®‰∫éÁ§æ‰∫§Â™í‰ΩìÂ§¥ÂÉè„ÄÅ‰∫ßÂìÅÂõæÁâá' },
  { label: '16:9 ÂÆΩÂ±è', value: '1.7778', desc: 'ÈÄÇÁî®‰∫éËßÜÈ¢ëÂ∞ÅÈù¢„ÄÅÊ®™ÂπÖÂπøÂëä' },
  { label: '9:16 Á´ñÂ±è', value: '0.5625', desc: 'ÈÄÇÁî®‰∫éÊâãÊú∫Â£ÅÁ∫∏„ÄÅÁ´ñÁâàËßÜÈ¢ë' },
  { label: '4:3 Ê†áÂáÜ', value: '1.3333', desc: 'ÈÄÇÁî®‰∫éÊñáÊ°£ÈÖçÂõæ„ÄÅÊºîÁ§∫ÊñáÁ®ø' },
  { label: '3:2 ÁÖßÁâá', value: '1.5', desc: 'ÈÄÇÁî®‰∫éÊ†áÂáÜÁÖßÁâá„ÄÅÊâìÂç∞Â∞∫ÂØ∏' },
  { label: '2:3 ËØÅ‰ª∂', value: '0.6667', desc: 'ÈÄÇÁî®‰∫éËØÅ‰ª∂ÁÖß„ÄÅ‰∫∫ÂÉèÁÖßÁâá' },
  { label: '21:9 Ë∂ÖÂÆΩ', value: '2.3333', desc: 'ÈÄÇÁî®‰∫éÁîµÂΩ±Êµ∑Êä•„ÄÅÂÖ®ÊôØÂõæÁâá' }
]

// Â∏∏ËßÅÈóÆÈ¢ò
const faq = [
  {
    q: 'ÊîØÊåÅÂì™‰∫õÂõæÁâáÊ†ºÂºèÔºü',
    a: 'ÊîØÊåÅ‰∏ä‰º†JPG„ÄÅPNG„ÄÅWebPÁ≠âÂ∏∏ËßÅÂõæÁâáÊ†ºÂºèÔºåÂØºÂá∫Êó∂ÂèØÈÄâÊã©Ëøô‰∏âÁßçÊ†ºÂºèÁöÑ‰ªªÊÑè‰∏ÄÁßç„ÄÇ'
  },
  {
    q: 'Â¶Ç‰Ωï‰øùÊåÅÂõæÁâáÈÄèÊòéËÉåÊôØÔºü',
    a: 'ÂØπ‰∫éÂ∏¶ÊúâÈÄèÊòéËÉåÊôØÁöÑPNGÂõæÁâáÔºåÈÄâÊã©PNGÊ†ºÂºèÂØºÂá∫Âç≥ÂèØ‰øùÊåÅÈÄèÊòéËÉåÊôØ„ÄÇ'
  },
  {
    q: 'Ë£ÅÂàáÂêéÁöÑÂõæÁâáË¥®ÈáèÂ¶Ç‰ΩïÔºü',
    a: 'Êàë‰ª¨ÈááÁî®È´òË¥®ÈáèÁöÑÂõæÁâáÂ§ÑÁêÜÁÆóÊ≥ïÔºåÁ°Æ‰øùË£ÅÂàáÂêéÁöÑÂõæÁâáÊ∏ÖÊô∞Â∫¶‰∏ç‰ºöÈôç‰Ωé„ÄÇ'
  },
  {
    q: 'ÊúâÊñá‰ª∂Â§ßÂ∞èÈôêÂà∂ÂêóÔºü',
    a: '‰∏∫‰∫Ü‰øùËØÅÂ§ÑÁêÜÊÄßËÉΩÔºåÂª∫ËÆÆ‰∏ä‰º†Â∞è‰∫é10MBÁöÑÂõæÁâá„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÂ§ÑÁêÜÊõ¥Â§ßÁöÑÂõæÁâáÔºåÂª∫ËÆÆÂÖàËøõË°åÂéãÁº©„ÄÇ'
  }
]

// Êñá‰ª∂Â§ÑÁêÜÊñπÊ≥ï
const handleFileChange = (e: Event) => {
  const input = e.target as HTMLInputElement
  if (!input.files?.length) return

  const file = input.files[0]
  handleFile(file)
}

const handleDrop = (e: DragEvent) => {
  e.preventDefault()
  isDragging.value = false

  const file = e.dataTransfer?.files[0]
  if (file) handleFile(file)
}

const handleFile = (file: File) => {
  if (!file.type.startsWith('image/')) {
    alert('ËØ∑Âè™ÈÄâÊã©ÂõæÁâáÊñá‰ª∂')
    return
  }

  currentFile.value = file
  imageUrl.value = URL.createObjectURL(file)
}

// Ë£ÅÂàáÁõ∏ÂÖ≥ÊñπÊ≥ï
const setAspectRatio = (value: string | number) => {
  aspectRatio.value = value === 'free' ? undefined : Number(value)
  if (cropperRef.value) {
    cropperRef.value.setAspectRatio(aspectRatio.value)
  }
}

const onCrop = (data: any) => {
  if (!cropperRef.value) return

  const canvas = cropperRef.value.getCroppedCanvas({
    width: data.width,
    height: data.height,
    imageSmoothingEnabled: true,
    imageSmoothingQuality: 'high',
    fillColor: selectedFormat.value === 'PNG' ? 'transparent' : '#fff'
  })

  if (canvas) {
    const mimeType = `image/${selectedFormat.value.toLowerCase()}`
    const quality = selectedFormat.value === 'PNG' ? 1 : 0.9
    croppedImageUrl.value = canvas.toDataURL(mimeType, quality)
  }
}

const zoom = (delta: number) => {
  if (!cropperRef.value) return
  scale.value = Math.max(0.5, Math.min(3, scale.value + delta))
  cropperRef.value.zoom(delta)
}

const rotate = (angle: number) => {
  if (!cropperRef.value) return
  rotateAngle.value = (rotateAngle.value + angle) % 360
  cropperRef.value.rotate(angle)
}

const updateImageAdjustments = () => {
  if (!cropperRef.value) return

  const canvas = cropperRef.value.getCroppedCanvas()
  if (!canvas) return

  const ctx = canvas.getContext('2d')
  if (!ctx) return

  ctx.filter = `brightness(${brightness.value}%) contrast(${contrast.value}%)`
  ctx.drawImage(canvas, 0, 0)
}

// ‰∏ãËΩΩÂ§ÑÁêÜ
const handleDownload = () => {
  if (!croppedImageUrl.value || !currentFile.value) return

  const link = document.createElement('a')
  link.href = croppedImageUrl.value
  const ext = selectedFormat.value.toLowerCase()
  const fileName = currentFile.value.name.replace(/\.[^/.]+$/, '')
  link.download = `${fileName}_cropped.${ext}`
  document.body.appendChild(link)
  link.click()
  document.body.removeChild(link)
}

// Ê∏ÖÈô§ÂõæÁâá
const clearImage = () => {
  currentFile.value = null
  imageUrl.value = ''
  croppedImageUrl.value = ''
  aspectRatio.value = undefined
  brightness.value = 100
  contrast.value = 100
  scale.value = 1
  rotateAngle.value = 0
}

// ÈîÆÁõò‰∫ã‰ª∂Â§ÑÁêÜ
const handleKeyDown = (e: KeyboardEvent) => {
  if (!cropperRef.value) return

  const step = e.shiftKey ? 10 : 1

  switch (e.key) {
    case 'ArrowLeft':
      cropperRef.value.move(-step, 0)
      break
    case 'ArrowRight':
      cropperRef.value.move(step, 0)
      break
    case 'ArrowUp':
      cropperRef.value.move(0, -step)
      break
    case 'ArrowDown':
      cropperRef.value.move(0, step)
      break
  }
}

// Ê∑ªÂä†ÈîÆÁõò‰∫ã‰ª∂ÁõëÂê¨
window.addEventListener('keydown', handleKeyDown)
</script>

<style scoped>
.cropper-container {
  max-height: 600px;
}

/* Á¶ÅÁî®ÂõæÁâáÊãñÂä® */
img {
  user-select: none;
  -webkit-user-drag: none;
}
</style>
